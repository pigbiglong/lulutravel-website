<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Login</title>
</head>
<body>
    <h1>Login Test</h1>
    <div id="status">Not logged in</div>
    <hr>
    
    <h2>Register</h2>
    <input type="email" id="regEmail" placeholder="Email">
    <input type="password" id="regPass" placeholder="Password">
    <input type="text" id="regName" placeholder="Name">
    <button onclick="register()">Register</button>
    
    <hr>
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPass" placeholder="Password">
    <button onclick="login()">Login</button>
    
    <hr>
    <button onclick="logout()">Logout</button>
    <button onclick="check()">Check Session</button>

    <script>
        // 本地存储模拟
        const localAuth = {
            users: JSON.parse(localStorage.getItem('lulutravel_users') || '[]'),
            currentUser: JSON.parse(localStorage.getItem('lulutravel_currentUser') || 'null'),
            saveUsers: function() { localStorage.setItem('lulutravel_users', JSON.stringify(this.users)); },
            saveCurrentUser: function() { localStorage.setItem('lulutravel_currentUser', JSON.stringify(this.currentUser)); },
            signUp: function(email, password, name) {
                if (this.users.find(u => u.email === email)) return { error: { message: 'Email already registered' } };
                const user = { email, password, name, id: Date.now() };
                this.users.push(user);
                this.saveUsers();
                this.currentUser = { email, name, id: user.id };
                this.saveCurrentUser();
                return { data: { user: this.currentUser }, error: null };
            },
            signIn: function(email, password) {
                const user = this.users.find(u => u.email === email && u.password === password);
                if (!user) return { error: { message: 'Invalid email or password' } };
                this.currentUser = { email: user.email, name: user.name, id: user.id };
                this.saveCurrentUser();
                return { data: { user: this.currentUser }, error: null };
            },
            signOut: function() { this.currentUser = null; this.saveCurrentUser(); return { error: null }; },
            getSession: function() { return { data: { session: this.currentUser ? { user: this.currentUser } : null } }; }
        };

        function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPass').value;
            const name = document.getElementById('regName').value;
            const result = localAuth.signUp(email, password, name);
            if (result.error) {
                alert('Error: ' + result.error.message);
            } else {
                alert('Registered!');
                updateStatus();
            }
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;
            const result = localAuth.signIn(email, password);
            if (result.error) {
                alert('Error: ' + result.error.message);
            } else {
                alert('Logged in!');
                updateStatus();
            }
        }

        function logout() {
            localAuth.signOut();
            alert('Logged out!');
            updateStatus();
        }

        function check() {
            const session = localAuth.getSession();
            alert('Session: ' + JSON.stringify(session));
        }

        function updateStatus() {
            const session = localAuth.getSession();
            document.getElementById('status').textContent = session.data.session 
                ? 'Logged in as: ' + session.data.session.user.email 
                : 'Not logged in';
        }

        updateStatus();
    </script>
</body>
</html>
